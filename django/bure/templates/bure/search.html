<!-- /bure/templates/bure/search.html -->

{% extends "bure/base.html" %}
{% load static %}

{% block content %}
<div class="estimate-container">
  <h1 style="margin: 10px;">Rent Estimate</h1>
  <p style="margin-bottom: 15px;">Enter your unit details and amenities to get an estimated monthly rent.</p>

  <form method="get" action="" id="estimate-form">

    <fieldset class="basic-fields">
        <legend>Location</legend>

        <div class="location-mode-toggle">
            <button type="button" class="mode-btn active" data-mode="list">List</button>
            <button type="button" class="mode-btn" data-mode="map">Map</button>
            <input type="hidden" name="location_mode" id="location_mode" value="list">
        </div>

        <div id="location-list-mode">
          <label>
            <input type="radio" name="location" value="allston">
            Allston
          </label>
          <label>
            <input type="radio" name="location" value="beacon_hill">
            Beacon Hill
          </label>
          <label>
            <input type="radio" name="location" value="south_boston">
            South Boston
          </label>
          <label>
            <input type="radio" name="location" value="back_bay">
            Back Bay
          </label>
        </div>

        <div id="location-map-mode" style="display: none;">
            <p class="helper-text">
                Click one of the areas on the map to select locations.
            </p>

            <div id="location-map" class="map-container"></div>
            <!-- 
                map_toggle.js will inject html, for example:

                <input type="hidden" name="locations" value="allston">
            -->
            <div id="map-location-inputs"></div>
        </div>
    </fieldset>

    <fieldset class="basic-fields">
      <legend>Basic Info</legend>

      <label for="beds">Beds</label>
      <input
        type="number"
        name="beds"
        id="beds"
        min="0"
        step="1"
        required
      />

      <label for="baths">Baths</label>
      <input
        type="number"
        name="baths"
        id="baths"
        min="0"
        step="0.5"
        required
      />

      <label for="sqft">Square Feet</label>
      <input
        type="number"
        name="sqft"
        id="sqft"
        min="0"
        step="1"
        required
      />
    </fieldset>

   <fieldset class="amenities">
    <legend>Amenities</legend>
    <div id="amenities-container">
       <p>Select a location to see amenities.</p>
    </div>
  </fieldset>


    </fieldset>

    <button type="submit" class="btn-primary">Get Estimate</button>
  </form>
</div>

<style>
  .estimate-container {
    max-width: 700px;
    margin: 2rem auto;
    padding: 1.5rem;
  }

  form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  fieldset {
    border: 1px solid #ddd;
    padding: 1rem 1.25rem;
    border-radius: 8px;
  }

  legend {
    font-weight: 600;
    padding: 0 0.25rem;
  }

  .basic-fields label {
    display: block;
    margin-top: 0.75rem;
    font-weight: 500;
  }

  .basic-fields input[type="number"] {
    width: 100%;
    padding: 0.4rem 0.6rem;
    margin-top: 0.25rem;
  }

  .amenities {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 0.5rem 1rem;
  }

  .amenities label {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    font-size: 0.95rem;
  }

  .btn-primary {
    margin: 0 auto;
    font-size: 20px;
    max-width: 200px;
    padding: 0.6rem 1.2rem;
    border-radius: 15px;
    color: black;
    border: 2px solid rgba(0, 0, 0, 0.283);
    cursor: pointer;
    font-weight: 570;
    transition: all .3s ease-in-out;
  }

  .btn-primary:hover {
    text-decoration: none;
    background-color: #003366;
    border: 2px solid black;
    color: #ffffff;
  }



  .map-container {
    width: 100%;
    height: 320px;
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid #ddd;
    margin-top: 0.5rem;
  }

  .location-mode-toggle {
    display: inline-flex;
    border-radius: 999px;
    border: 1px solid #ddd;
    overflow: hidden;
    margin-bottom: 0.75rem;
  }

  .location-mode-toggle .mode-btn {
    padding: 0.3rem 0.9rem;
    border: none;
    background: transparent;
    font-size: 0.9rem;
    cursor: pointer;
  }

  .location-mode-toggle .mode-btn.active {
    background: #f4f4f4;
    font-weight: 600;
  }

  .helper-text {
    font-size: 0.85rem;
    color: #666;
    margin-bottom: 0.4rem;
  }

</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const locationRadios = document.querySelectorAll('input[name="location"]');
    const amenitiesContainer = document.getElementById("amenities-container");

    const amenitiesUrl = "{% url 'estimate_amenities' %}";

    function renderAmenities(amenities) {
      if (!amenities || amenities.length === 0) {
        amenitiesContainer.innerHTML = "<p>No amenities configured for this location.</p>";
        return;
      }

      amenitiesContainer.innerHTML = "";

      amenities.forEach((amenity) => {
        const label = document.createElement("label");

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.name = amenity.name;
        checkbox.value = "1";

        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(" " + amenity.label));

        amenitiesContainer.appendChild(label);
      });
    }

    locationRadios.forEach((radio) => {
      radio.addEventListener("change", () => {
        const loc = radio.value;

        fetch(amenitiesUrl + "?location=" + encodeURIComponent(loc))
          .then((response) => response.json())
          .then((data) => {
            renderAmenities(data.amenities);
          })
          .catch((err) => {
            console.error("Error fetching amenities:", err);
            amenitiesContainer.innerHTML = "<p>Could not load amenities.</p>";
          });
      });
    });

    const initiallyChecked = document.querySelector('input[name="location"]:checked');
    if (initiallyChecked) {
      initiallyChecked.dispatchEvent(new Event("change"));
    }
  });
</script>

{% endblock %}
